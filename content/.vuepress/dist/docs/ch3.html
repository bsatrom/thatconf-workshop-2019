<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 3: Using the Particle IoT Rules Engine &amp; FileMaker | Particle Argon Workshop</title>
    <meta name="description" content="Workshops designed to teach the basics of IoT development with the Particle ecosystem &amp; the Particle Argon">
    
    
    <link rel="preload" href="/assets/css/5.styles.33d2c262.css" as="style"><link rel="preload" href="/assets/js/app.bfbb8189.js" as="script"><link rel="preload" href="/assets/js/0.61bfee1a.js" as="script"><link rel="prefetch" href="/assets/js/1.a119d4ce.js"><link rel="prefetch" href="/assets/js/2.f4ba495e.js"><link rel="prefetch" href="/assets/js/3.5658adcc.js"><link rel="prefetch" href="/assets/js/4.053935c5.js">
    <link rel="stylesheet" href="/assets/css/5.styles.33d2c262.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Particle Argon Workshop
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Team
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><a href="https://github.com/particle-iot/filemaker-workshop-2019" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Team
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><a href="https://github.com/particle-iot/filemaker-workshop-2019" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><a href="/docs/" class="sidebar-link">About Particle Workshops</a></li><li><a href="/docs/ch1.html" class="sidebar-link">Chapter 1: Getting your Particle Argon online</a></li><li><a href="/docs/ch2.html" class="sidebar-link">Chapter 2: Working with Particle primitives &amp; Grove Sensors</a></li><li><a href="/docs/ch3.html" class="active sidebar-link">Chapter 3: Using The Particle IoT Rules Engine &amp; FileMaker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/ch3.html#introducing-the-particle-iot-rules-engine" class="sidebar-link">Introducing the Particle IoT Rules Engine</a></li><li class="sidebar-sub-header"><a href="/docs/ch3.html#ingesting-and-displaying-data-in-the-rules-engine" class="sidebar-link">Ingesting and displaying data in the Rules Engine</a></li><li class="sidebar-sub-header"><a href="/docs/ch3.html#transforming-data-and-building-dashboards-in-the-rules-engine" class="sidebar-link">Transforming Data and Building Dashboards in the Rules Engine</a></li><li class="sidebar-sub-header"><a href="/docs/ch3.html#connecting-rules-engine-flows-to-azure-iot-central" class="sidebar-link">Connecting Rules Engine Flows to Azure IoT Central</a></li></ul></li></ul></div><div class="page"><div class="content"><h1 id="chapter-3-using-the-particle-iot-rules-engine-filemaker"><a href="#chapter-3-using-the-particle-iot-rules-engine-filemaker" aria-hidden="true" class="header-anchor">#</a> Chapter 3: Using the Particle IoT Rules Engine &amp; FileMaker</h1><table><thead><tr><th><strong>Project Goal</strong></th><th>Connect your device to the Particle IoT Rules Engine, create simple dashboards and &quot;backhaul&quot; sensor data to FileMaker.</th></tr></thead><tbody><tr><td><strong>What you’ll learn</strong></td><td>Working with the Particle IoT Rules Engine; Piping sensor data into FileMaker.</td></tr><tr><td><strong>Tools you’ll need</strong></td><td>Particle Workbench, Particle IoT Rules Engine Account, a Particle Argon and the Grove Starter Kit for Particle Mesh</td></tr><tr><td><strong>Time needed to complete</strong></td><td>60 minutes</td></tr></tbody></table><p>In this session, we're going to explore the Particle IoT Rules Engine, before moving onto 3rd party integrations with FileMaker.</p><h2 id="introducing-the-particle-iot-rules-engine"><a href="#introducing-the-particle-iot-rules-engine" aria-hidden="true" class="header-anchor">#</a> Introducing the Particle IoT Rules Engine</h2><p>The Particle IoT Rules Engine is an IF/THEN workflow builder tailor-made for IoT use cases. It's meant to enable anyone on an IoT project team create conditional logic using a visual interface.</p><p>We suggest <a href="https://docs.particle.io/tutorials/iot-rules-engine/quickstart/" target="_blank" rel="noopener noreferrer">visiting the Particle Docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for an in-depth overview on the Particle IoT Rules Engine. In the meantime, the key concepts to understand are that you'll work with the Rules Engine by using units of functionality (called nodes) from a visual menu of available nodes (called the palette) to form a connected sequence of steps (called a flow), where messages are passed between each step.</p><p>In this section of the lab, we'll create a flow to ingest and transform sensor data from your Continental.iot device, build dashboards to visualize that data, and add UI to trigger basic interactions back on your embedded device.</p><h3 id="publishing-environmental-sensor-data"><a href="#publishing-environmental-sensor-data" aria-hidden="true" class="header-anchor">#</a> Publishing environmental sensor data</h3><p>The Particle IoT Rules Engine is connected to the Particle Device Cloud, which means that anythig you make cloud-accessible via Pub/Sub, Functions or Variables (all of which we covered in the last lab), can be leveraged by the Rules Engine. Let's make a quick modification to our project from the last lab to publish environmenal data collected by thr Grove Barmoeter sensor.</p><ol><li>First, we'll need to install a new library: the <code>JsonParserGenerator</code>, which will help us build JSON objects with multiple fields to post to the Particle Cloud. Open the Particle Workbench Command Palette (CMD/CTRL+SHIFT+P) and select the &quot;Install Library&quot; option.</li><li>In the input field, type &quot;JsonParserGeneratorRK&quot; and hit enter.</li><li>Once the library is installed, add an include statement to the top of your project</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;JsonParserGeneratorRK.h&quot;</span></span>
</code></pre></div><ol start="4"><li>To build the JSON object for posting, we'll create a new function called <code>postSensorData</code> that will take all three barometer sensor readings, format those into a JSON object, and then call <code>Particle.publish</code> to post them to the Device Cloud.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">postSensorData</span><span class="token punctuation">(</span><span class="token keyword">int</span> temp<span class="token punctuation">,</span> <span class="token keyword">int</span> pressure<span class="token punctuation">,</span> <span class="token keyword">int</span> altitude<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  JsonWriterStatic<span class="token operator">&lt;</span><span class="token number">256</span><span class="token operator">&gt;</span> jsonWriter<span class="token punctuation">;</span>

  <span class="token punctuation">{</span>
    JsonWriterAutoObject <span class="token function">obj</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>jsonWriter<span class="token punctuation">)</span><span class="token punctuation">;</span>

    jsonWriter<span class="token punctuation">.</span><span class="token function">insertKeyValue</span><span class="token punctuation">(</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    jsonWriter<span class="token punctuation">.</span><span class="token function">insertKeyValue</span><span class="token punctuation">(</span><span class="token string">&quot;pressue&quot;</span><span class="token punctuation">,</span> pressure<span class="token punctuation">)</span><span class="token punctuation">;</span>
    jsonWriter<span class="token punctuation">.</span><span class="token function">insertKeyValue</span><span class="token punctuation">(</span><span class="token string">&quot;altitude&quot;</span><span class="token punctuation">,</span> altitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Particle<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;environment/latest&quot;</span><span class="token punctuation">,</span> jsonWriter<span class="token punctuation">.</span><span class="token function">getBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>Now, in the <code>loop</code>, add a call to this new function, just after the <code>Serial</code> print commands.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">postSensorData</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> pressure<span class="token punctuation">,</span> altitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="6"><li>Flash these changes to your device and open the device dashboard in the Particle Console. Once the device comes back online, you should see events posting every 10 seconds. Click on one of the entries to see the formatted JSON result.</li></ol><p><img src="/assets/img/json-sensors.9ab0adf2.png" alt></p><p>Now you're ready to start using the Particle IoT Rules Engine!</p><h3 id="creating-your-first-rules-engine-flow"><a href="#creating-your-first-rules-engine-flow" aria-hidden="true" class="header-anchor">#</a> Creating your first Rules Engine Flow</h3><ol><li><p>Open your Rules Engine instance. The URL and login information should have been provided by your instructor.</p></li><li><p>Click the plus (+) tab at the top right of the screen to create a new flow.</p></li></ol><p><img src="/assets/img/newFlow.2ad926de.png" alt></p><ol start="3"><li>Double-click on the flow to change its default name and give it a description.</li></ol><p><img src="/assets/img/edit-description.1951870e.png" alt></p><p>Once created, your new flow will just be an empty, gridded palette. Let's start adding nodes to it and build a flow!</p><p><img src="/assets/img/emptyflow.a09f3b30.png" alt></p><h2 id="ingesting-and-displaying-data-in-the-rules-engine"><a href="#ingesting-and-displaying-data-in-the-rules-engine" aria-hidden="true" class="header-anchor">#</a> Ingesting and displaying data in the Rules Engine</h2><h3 id="subscribing-to-particle-cloud-events"><a href="#subscribing-to-particle-cloud-events" aria-hidden="true" class="header-anchor">#</a> Subscribing to Particle Cloud events</h3><p>You may have already noticed that the node palette on the left side of the Rules Engine window contains five Particle nodes. These nodes provide easy access to Particle primitives (pub/sub, functions, variables), as well as any public endpoint in the Particle API. Let's use the Particle subscribe node to ingest our environmental data.</p><p><img src="/assets/img/particlenodes.1155ff08.png" alt></p><ol><li>Click and drag the <code>subscribe</code> node and drop it anywhere on the flow at the center of your screen.</li></ol><p><img src="/assets/img/subscribe-node.c4af9d63.png" alt></p><ol start="2"><li>Double-click on the node to open its configuration window.</li></ol><p><img src="/assets/img/subscribe-config.95206f5b.png" alt></p><ol start="3"><li>Give the node a name, like &quot;Environment Sensors.&quot;</li></ol><p><img src="/assets/img/name-sub.f124956e.png" alt></p><ol start="4"><li>Next, we need to set-up a mechanism for the Rules Engine flow to safely access your device data. Click on the pencil icon next to the &quot;Auth&quot; setting row and you'll see a window that instructs you to create an OAuth client, which we'll do now.</li></ol><p><img src="/assets/img/node-oauth.9d32de2a.png" alt></p><ol start="5"><li>Open <a href="https://console.particle.io" target="_blank" rel="noopener noreferrer">the Particle console<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and click on the fingerprint icon to navigate to the authentication section.</li></ol><p><img src="/assets/img/console-oauth.002c6762.png" alt></p><ol start="6"><li>Click the &quot;New Client&quot; button on the Authentication screen.</li></ol><p><img src="/assets/img/new-client-button.619995bf.png" alt></p><ol start="7"><li>When creating a Particle OAuth client, there are a number of supported client types, depending on whether you need server-based authentication, self-contianed auth for a mobile app, or your own custom approach. For connecting to Rules Engine flows, you'll want to use the &quot;Two-Legged Auth (Server)&quot; option. Make sure that option is selected, give the client a name, and click the &quot;Get Client ID and Secret&quot; button.</li></ol><p><img src="/assets/img/oauth-client.aaa560f5.png" alt></p><ol start="8"><li>Once the client is created, you'll be provided with the client ID and secret, both of which you'll need in the next step. Make sure you copy the client secret and keep it somewhere safe as you won't be able to access it again once you click the &quot;I've Copied my Secret&quot; button!</li></ol><p><img src="/assets/img/client-created.0a059acf.png" alt></p><ol start="9"><li>Copy your client ID and secret and enter them in the inputs back in the Rules Engine configuration screen. Click &quot;Update&quot; once you're done.</li></ol><p><img src="/assets/img/client-config.48e57d19.png" alt></p><ol start="10"><li>Once your Auth information is set, you can complete the rest of the settings for the subscribe node. First, enter the event nameto subscribe to, which we set as <code>environment/latest</code> in the last section. Then,set your device name or ID.</li></ol><p><img src="/assets/img/sub-config.052b9798.png" alt></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>If you don't know your device name or ID, you can find both in the console, at the top of your device dashboard screen.</p><p><img src="/assets/img/id-name.fe2b95a5.png" alt></p></div><h3 id="using-the-debug-node-and-deploying-flows"><a href="#using-the-debug-node-and-deploying-flows" aria-hidden="true" class="header-anchor">#</a> Using the Debug Node and deploying flows</h3><ol start="11"><li>To make sure that your sensor data is properly wired up to the Rules Engine, you can use the debug node. Find it under the &quot;Output&quot; section of the palette, or search for it using the search input at the top left of the screen.</li></ol><p><img src="/assets/img/debug-node.2433cb17.png" alt></p><ol start="12"><li>Drag the debug node onto your flow. Connect it to the subscribe node by clicking on the grey square on the right side of the subscribe node, and dragging the line that appears to the box on the left of the debug node.</li></ol><p><img src="/assets/img/connect-debug.d76313ed.png" alt></p><ol start="13"><li>Now your flow is ready to test, but it won't run until its deployed. To do that, click the &quot;Deploy&quot; button at the top right of the screen.</li></ol><p><img src="/assets/img/deploy-sub.829c31ed.png" alt></p><p>Once deployed, you'll see a success message like the one below.</p><p><img src="/assets/img/deployed.aad84aa2.png" alt></p><ol start="14"><li>To see debug messages, you'll need to open the debug tab in the flow sidebar. If it's not already open, you can do so by dragging on the sidebar handle on the right of the Rules Engine window.</li></ol><p><img src="/assets/img/flow-sidebar.efa9b6a6.png" alt></p><ol start="15"><li>To open the debug tab, click the bug icon in the flow info panel.</li></ol><p><img src="/assets/img/debug-tab.887d0e1d.png" alt></p><ol start="16"><li>Once open, you should see the output of the subscribe node as new messages come in every ten seconds.</li></ol><p><img src="/assets/img/debug-subs.3170755a.png" alt></p><p>Nice work, you've wired your Continental.iot project up to the Rules Engine! Now let's build some simple dashboards using the built-in tools.</p><h2 id="transforming-data-and-building-dashboards-in-the-rules-engine"><a href="#transforming-data-and-building-dashboards-in-the-rules-engine" aria-hidden="true" class="header-anchor">#</a> Transforming Data and Building Dashboards in the Rules Engine</h2><p>In addition to creating workflows with the Rules Engine, you can also create dashboards to visualize device data. In this section, we'll look at adding gauges, charts and some UI to trigger basic interactivity.</p><h3 id="creating-charts"><a href="#creating-charts" aria-hidden="true" class="header-anchor">#</a> Creating Charts</h3><p>Charts are useful for viewing data across a quantifiable sequence, or period like time. In this section, we'll create a single line graph that displays readings from our barometer sensor, over time.</p><h4 id="formatting-input-data-for-display"><a href="#formatting-input-data-for-display" aria-hidden="true" class="header-anchor">#</a> Formatting input data for display</h4><ol><li>The first thing we need to do is format the sensor data from our publish event. The data somes in as a JSON string, but we need to convert it to a JSON object in order to access the data for our dashboards. Thankfully, the Rules Engine provides a <code>json</code> node we can use for just this purpose. Find the node in the &quot;Function&quot; section, or by searching for &quot;json&quot;.</li></ol><p><img src="/assets/img/json.91e8776a.png" alt></p><ol start="2"><li>Drag the JSON node to your flow, and connect it to the &quot;Environment Sensors&quot; subscrobe node.</li></ol><p><img src="/assets/img/tojson.9bfc1a9d.png" alt></p><ol start="3"><li>Double-click on the <code>json</code> node to open its properties. Keep the defaults, and give the node a name, like &quot;To JSON.&quot; Click Done.</li></ol><p><img src="/assets/img/jsonprops.865dbbfa.png" alt></p><ol start="4"><li>Next, we need to format the data for our chart. Oftentimes, you'll need to transform or shape data in order to feed it into future steps in a workflow. The Rules Engine provides a general-purpose <code>function</code> node for this purpose. This node accepts a message from a previous step, and executes user-defined JavaScript that transforms the input data into an output message to be passed along to the next step in the flow. Find the function node under the Fuction palette group, or by searching for function. Note: that the general-purpose function is NOT the Particle function node, which you will also see in a search.</li></ol><p><img src="/assets/img/functionnode.8ad2a7c3.png" alt></p><ol start="5"><li>Drag the function node onto your flow and connect it to the &quot;To JSON&quot; node.</li></ol><p><img src="/assets/img/emptyfnnode.e153f259.png" alt></p><ol start="6"><li>Double-click on the function node and give it a name like &quot;format temp for chart.&quot; In the function textarea, add some JavaScript code to extract the temperature from the incoming message and format it for the graph we'll create</li></ol><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> tempMsg <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

tempMsg<span class="token punctuation">.</span>payload <span class="token operator">=</span> msg<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>temperature<span class="token punctuation">;</span>
tempMsg<span class="token punctuation">.</span>topic <span class="token operator">=</span> <span class="token string">&quot;Temperature&quot;</span><span class="token punctuation">;</span>

msg <span class="token operator">=</span> tempMsg<span class="token punctuation">;</span>

<span class="token keyword">return</span> msg<span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You might wonder at this point why we're creating a new object and only passing along the temperature. Dashboard nodes need the incoming to <a href="https://github.com/node-red/node-red-dashboard/blob/master/Charts.md" target="_blank" rel="noopener noreferrer">conform to a consistent format<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in order for data to be parsed and displayed using a given UI component. If you want to display more than a single series of data on a chart, each series needs to be labeled with a <code>topic</code> and the payload must be a single numeric value. Thus, to show three sets of data on a single chart, we have to pass along three distinct messages.</p></div><ol start="7"><li>Once you've added the snippet above, click &quot;Done.&quot; Your flow should now look like this.</li></ol><p><img src="/assets/img/firstfn.8b208ada.png" alt></p><ol start="8"><li><p>Now let's add function nodes for pressure and altitude, and format their data accordingly. Drag two more funciton nodes to the flow and connect them to the &quot;To JSON&quot; node.</p></li><li><p>Double-click on the first function node, give it a name like &quot;format pressure for chart&quot; and add the following code to format the pressure data for the chart.</p></li></ol><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> pressureMsg <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

pressureMsg<span class="token punctuation">.</span>payload <span class="token operator">=</span> msg<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>pressure<span class="token punctuation">;</span>
pressureMsg<span class="token punctuation">.</span>topic <span class="token operator">=</span> <span class="token string">&quot;Pressure&quot;</span><span class="token punctuation">;</span>

msg <span class="token operator">=</span> pressureMsg<span class="token punctuation">;</span>

<span class="token keyword">return</span> msg<span class="token punctuation">;</span>
</code></pre></div><ol start="10"><li>Double-click on the second function node, give it a name like &quot;format altitude for chart&quot; and add the following code to format the pressure data for the chart.</li></ol><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> altMsg <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

altMsg<span class="token punctuation">.</span>payload <span class="token operator">=</span> msg<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>altitude<span class="token punctuation">;</span>
altMsg<span class="token punctuation">.</span>topic <span class="token operator">=</span> <span class="token string">&quot;Altitude&quot;</span><span class="token punctuation">;</span>

msg <span class="token operator">=</span> altMsg<span class="token punctuation">;</span>

<span class="token keyword">return</span> msg<span class="token punctuation">;</span>
</code></pre></div><ol start="11"><li>Now, you should have three functions connected to your JSON object, and the flow should look something like this.</li></ol><p><img src="/assets/img/allfns.ce5d5a4f.png" alt></p><p>Now we're ready for our chart!</p><h4 id="adding-the-dashboard-ui"><a href="#adding-the-dashboard-ui" aria-hidden="true" class="header-anchor">#</a> Adding the Dashboard UI</h4><p>As with everything else in the Rules Engine, dashboard functionality is accessible via a collection of nodes. The Particle IoT Rules Engine provides a number of such nodes under the &quot;Dashboard&quot; palette group, including charts, gauges, and input controls like buttons and switches.</p><p><img src="/assets/img/dashboard.931c5a0e.png" alt></p><ol><li>Drag the &quot;chart&quot; node to the flow and connect each function node from the previous section to its input.</li></ol><p><img src="/assets/img/newchart.af2213c3.png" alt></p><ol start="2"><li>Double-click on the chart node to open its properties panel. When creating a dashboard, you need to instruct the Rules Engine where to display the data. It's possible to create multiple dashboards across a Rules Engine instance, and we want to create a single view for our sensor data. Open the &quot;Group&quot; dropdown and select &quot;Add new ui_group.&quot; Then, click on the pencil icon.</li></ol><p><img src="/assets/img/choosegroup.b13a448a.png" alt></p><ol start="3"><li>In the &quot;Add new dashboard group config node&quot; give the group a name, like &quot;Continental Sensors.&quot; Then, open the &quot;Tab&quot; dropdown, select the &quot;Add new ui_tab&quot; option, and click the pencil icon.</li></ol><p><img src="/assets/img/choosetab.067a1be0.png" alt></p><ol start="4"><li>In the &quot;Edit dashboard tab node,&quot; give the tab a name, like &quot;Continental.&quot; You can also modify the Icon if you wish (see the links on this properties pane for more info.). Click &quot;Update&quot; when done.</li></ol><p><img src="/assets/img/edittab.b00665ed.png" alt></p><ol start="5"><li><p>You'll be navigated back to the &quot;Add new dashboard group config node&quot; tab and your new tab should be selected. Click &quot;Add&quot; to continue.</p></li><li><p>With the new UI options set, you can now configure the chart. In the &quot;Edit chart node&quot; screen, set a label, provide a blank label like &quot;No data available&quot; for cases where data is pending, and give the node a name.</p></li></ol><p><img src="/assets/img/configchart.6a649313.png" alt></p><ol start="7"><li>Now, your flow should look like this. Click the &quot;Deploy&quot; button to deploy your changes and start charting!</li></ol><p><img src="/assets/img/flowwithchart.1bc44134.png" alt></p><ol start="8"><li>Once the deploy completes, you can open your new dashboard. Open the settings sidebar and look for the chart icon at the top right. Click it to open the Dashboard menu.</li></ol><p><img src="/assets/img/dashboardtab.2d0fd653.png" alt></p><ol start="9"><li>Click the launch icon at the top right of the dashobard tab to launch the dashboard for your Rules Engine Instance.</li></ol><p><img src="/assets/img/opendash.cdf5e57a.png" alt></p><ol start="10"><li>When the dashboard opens, you'll see your new chart, which will update as data streams in, real time.</li></ol><p><img src="/assets/img/chartview.b8b0e8b3.png" alt></p><p>Now lets add a gauge to our dashboard.</p><h3 id="creating-gauges"><a href="#creating-gauges" aria-hidden="true" class="header-anchor">#</a> Creating Gauges</h3><p>Gauges are useful for showing a single piece of quantifiable data at a point in time, and positioning that data between boundary conditions (min, max), or labeling the data based on where it falls within a range. For example, we can use a gauge to display the current temperature and where it falls within, safe, warning, and danger ranges. Let's do that for the temperature reading from our barometer now.</p><ol><li>Find the <code>gauge</code> node in the Dashboard, drag it onto the flow and connect it to the &quot;format temp for chart&quot; function node.</li></ol><p><img src="/assets/img/gauge.70a71bc4.png" alt></p><ol start="2"><li>Double-click on the node to open its property pane. Make sure the Group dropdown is set to the same group you set for the chart. Set the range inputs to a min of <code>0</code> and max of <code>110</code>. For the &quot;Colour gradient&quot; add the values <code>80</code> and <code>100</code> in the empty sector inputs. This tells the gauge to display green for values under 80, yellow for values between 80, and 100 for anything over 100. Finally, give the gauge node a name.</li></ol><p><img src="/assets/img/gaugeprops.1afa7499.png" alt></p><ol start="3"><li>Click &quot;Deploy&quot; to deploy your changes, and open your dashobard tab again. You should immediately see your gauge under the graph you created in the last section.</li></ol><p><img src="/assets/img/gaugeandchart.c408bd53.png" alt></p><p>And if your temp sensor detects a value above 80, the gauge color will change.</p><p><img src="/assets/img/gaugeyellow.c23571d6.png" alt></p><h3 id="adding-ui-for-interactivity"><a href="#adding-ui-for-interactivity" aria-hidden="true" class="header-anchor">#</a> Adding UI for Interactivity</h3><p>Now that we've explored using the Rules Engine a bit, let's add some interactivity. So far, we've used the Rules Engine to respond to incoming data. But we can also use the UI featutes of the Rules Engine dashboard to trigger actions on our device. In this section, we'll add a button that triggers a function call, when pressed.</p><h4 id="adding-a-readsensors-function-to-firmware"><a href="#adding-a-readsensors-function-to-firmware" aria-hidden="true" class="header-anchor">#</a> Adding a readSensors function to firmware</h4><p>Let's add a new function to our Argon firmware that will read the barometer sensor values, on demand.</p><ol><li>In the <code>setup</code> function, add a new <code>Particle.function</code> primitive.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>Particle<span class="token punctuation">.</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token string">&quot;readSensors&quot;</span><span class="token punctuation">,</span> readSensors<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>Next, add the <code>readSensors</code> function, which we can code by taking the existing <code>loop</code> code that reads and posts sensor data. We'll also add a conditional so we can log when a sensor check is triggered by the dashboard.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">readSensors</span><span class="token punctuation">(</span>String arguments<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  temp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">cToF</span><span class="token punctuation">(</span>bmp<span class="token punctuation">.</span><span class="token function">readTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pressure <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">pToHg</span><span class="token punctuation">(</span>bmp<span class="token punctuation">.</span><span class="token function">readPressure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Update to reflect current pressure at sea-level</span>
  altitude <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>bmp<span class="token punctuation">.</span><span class="token function">readAltitude</span><span class="token punctuation">(</span><span class="token number">1035.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arguments<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">printlnf</span><span class="token punctuation">(</span><span class="token string">&quot;Read request from: %s&quot;</span><span class="token punctuation">,</span> arguments<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Serial<span class="token punctuation">.</span><span class="token function">printlnf</span><span class="token punctuation">(</span><span class="token string">&quot;Temp: %i&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">printlnf</span><span class="token punctuation">(</span><span class="token string">&quot;Pressure: %i&quot;</span><span class="token punctuation">,</span> pressure<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">printlnf</span><span class="token punctuation">(</span><span class="token string">&quot;Altitude: %i&quot;</span><span class="token punctuation">,</span> altitude<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">postSensorData</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> pressure<span class="token punctuation">,</span> altitude<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>Flash this new firmware to your device and return to the Rules Engine.</li></ol><h4 id="triggering-a-function-call-from-the-rules-engine"><a href="#triggering-a-function-call-from-the-rules-engine" aria-hidden="true" class="header-anchor">#</a> Triggering a function call from the Rules Engine</h4><ol><li>To trigger a function call via user interaction, we can add the <code>button</code> dashboard node. Find the node and drag it to your flow, underneath the main sensors portion of the flow. Since this will be user-triggered, we don't want to connect it to the existing flow.</li></ol><p><img src="/assets/img/addbutton.7b735da0.png" alt></p><ol start="2"><li><p>Double-click the button to open its properties window. Add a label of &quot;Read from sensors&quot; and a name of &quot;Read Sensors.&quot; Click &quot;Done.&quot;</p></li><li><p>Next, drag a Particle function node from the Particle palette group, and connect it to the button.</p></li></ol><p><img src="/assets/img/buttonandfn.e966cead.png" alt></p><ol start="4"><li>Double-click the function node to open its property pane. Give it a name like &quot;Call readSensors.&quot; Make sure the Auth dropdown has the same selected value as your subscribe node from earlier in this lab. For the function field, type &quot;readSensors,&quot; and provide an argument value of &quot;dashboard.&quot; finally, set the device ID and click &quot;Done.&quot;</li></ol><p><img src="/assets/img/functionprops.39d4c3e8.png" alt></p><ol start="5"><li>Deploy your latest changes and open the dashboard UI page. You'll see a read from sensors button at the bottom.</li></ol><p><img src="/assets/img/buttonui.09bc392a.png" alt></p><p>Clicking the button will trigger the <code>readSensors</code> function on your device, which you can verify by opening a serial terminal and veiewing the output after each click.</p><p><img src="/assets/img/buttonterminal.0820628e.png" alt></p><h2 id="connecting-rules-engine-flows-to-azure-iot-central"><a href="#connecting-rules-engine-flows-to-azure-iot-central" aria-hidden="true" class="header-anchor">#</a> Connecting Rules Engine Flows to Azure IoT Central</h2><p>The Particle IoT Rules Engine is a great tool for creating workflows and simple visualizations, but sometimes you need to backhaul your data to a cloud provider for additional processing or routing. Thankfully, the Rules Engine makes this easy.</p><p>In the next labs, you'll explore Azure IoT Central and IoT Hub further. For now, let's connect your Continental.iot project to Azure IoT Hub using the Rules Engine. First, you'll need to set-up an IoT Hub instance.</p><h3 id="setting-up-an-azure-iot-hub"><a href="#setting-up-an-azure-iot-hub" aria-hidden="true" class="header-anchor">#</a> Setting up an Azure IoT Hub</h3><ol><li>Sign up for an <a href="https://azure.microsoft.com/en-us/get-started/" target="_blank" rel="noopener noreferrer">Azure Account<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, or sign in if you already have one.</li></ol><p><img src="/assets/img/azureacct.d865c7cf.png" alt></p><ol start="2"><li>In the dashboard, click &quot;Create a resource.&quot; Click &quot;Internet of Things,&quot; then &quot;IoT Hub&quot; at the top of the list.</li></ol><p><img src="/assets/img/resourcelist.38c4e550.png" alt></p><ol start="3"><li>Create a new resource group named <code>workshop-group</code> and give the hub a name. The name must be unique across all of Azure, but you'll receive a notification if the name you selected is not unique.</li></ol><p><img src="/assets/img/iothubdetails.118e533e.png" alt></p><ol start="4"><li>Click &quot;Review + create&quot;.</li></ol><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAckAAABSCAIAAACwi7gSAAABgWlDQ1BIRCA3MDktQQAAKJGVjj9rWmEUh59XTUxRqARpHUp5IaV0uAZjB6vJ4h+ohgxiW1C36/VGA1d9ub5i8gGyZUmG0C4tbb9CSZYMGUOGZAgUCtLPUBACpYTb4ZI6hdDf9JwHzjk/CGhTKScE9Prarb0uyHqjKcMTIkRZJMdj0xqqfLW6wZ25/o4AuEqaSjmbld8/1nbHn77Nr394mtPG3XsARNr20AKxAFjtodUD4QCGpVwN4j2QHGulQZwBcbfeaIKYAPGOz7+AeKveaEIgBMTdt7UiBBJArOXzCyDW8fkVELO6ZhsCZcDwOwDwoFySmVQ2mb+n93+n54xufwggavffvQFiwBPKlJBkSJElSV7b2xqgOFA77lanq2VeKceWxUFPjbTtGrLSt5YNmU6tpADqjab0T09rCEA8upy5wWfILkFwb+Zah3B8AonzmXv2ER6uwtGFMl3zX3FxHbpvHm6+TPscLcDcT8+bPofwAdzse96fL5538xWCEzh1/gIkd2ngdRvKIgAAAAlwSFlzAAALEwAACxMBAJqcGAAABjFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiBleGlmOlBpeGVsWERpbWVuc2lvbj0iNDU3IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iODIiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA4LTAyVDEzOjQ3OjIzLTA1OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wOC0wMlQxNDo0OTowOC0wNTowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wOC0wMlQxNDo0OTowOC0wNTowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJIRCA3MDktQSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1NGRiYTgzOC04NWQ5LTQ4YWUtYWY1MS0zNDdiODlkZGY3YjEiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDphNzI1ZmU0MC03MTI0LWQyNDAtYTEyNy0zMWE3NTNmOTRjODMiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpmYTYwYWEyYy1mOTYxLTRlYTktOTQ5Zi1lNzEyOGI4MTUyOTciPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpmYTYwYWEyYy1mOTYxLTRlYTktOTQ5Zi1lNzEyOGI4MTUyOTciIHN0RXZ0OndoZW49IjIwMTgtMDgtMDJUMTQ6NDk6MDgtMDU6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE4IChNYWNpbnRvc2gpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo1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" alt></p><ol start="5"><li>Click &quot;Create&quot;.</li></ol><p><img src="/assets/img/hubcreate.5d33ea88.png" alt></p><ol start="6"><li>You'll get a notification that your IoT Hub is being deployed, which may take a few minutes. Once done, pin the hub to your dashboard.</li></ol><p><img src="/assets/img/deploymentinprogress.88f24981.png" alt></p><ol start="7"><li>Click &quot;Go to resource&quot; to open the hub.</li></ol><p><img src="/assets/img/deploymentsucceeded.e806cd14.png" alt></p><ol start="8"><li><p>Click &quot;Shared access policies&quot;. We'll create a policy to allow the Particle Device Cloud to stream events into the hub.</p></li><li><p>Give the policy the name <code>workshop-policy</code>, select all four permissions, then click &quot;Create.&quot;</p></li></ol><p><img src="/assets/img/shared-access-policy.59b29fe5.png" alt></p><ol start="10"><li>Open the policy you just created and copy the &quot;Primary key.&quot;</li></ol><p><img src="/assets/img/policykey.089d41bd.png" alt></p><p>Now we can use connect our IoT Hub instance to our Rules Engine flow.</p><h3 id="using-the-azure-iot-hub-node"><a href="#using-the-azure-iot-hub-node" aria-hidden="true" class="header-anchor">#</a> Using the Azure IoT Hub node</h3><ol><li>Find the &quot;Azure IoT Hub&quot; node under the Azure palette group. Drag it to the workflow surface and connect it to the &quot;To JSON&quot; node.</li></ol><p><img src="/assets/img/azureiot.2c675b6f.png" alt></p><ol start="2"><li>Double-click on the Azure IoT Hub node and set its properties to use <code>mqtt</code> as the transport protocol and the name of your IoT Hub as the host.</li></ol><p><img src="/assets/img/hubprops.c7be2b48.png" alt></p><ol start="3"><li>Deploy the latest changes to your flow.</li></ol><h3 id="viewing-iot-hub-events"><a href="#viewing-iot-hub-events" aria-hidden="true" class="header-anchor">#</a> Viewing IoT Hub Events</h3><p>With the event set up, everything should be piping into the Azure IoT hub. We can verify using the <a href="https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-explorer-cloud-device-messaging?WT.mc_id=7061727469636c65" target="_blank" rel="noopener noreferrer">iothub-explorer command line utility<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p><ol><li><p>Install the iothub-explorer using the instructions <a href="https://github.com/azure/iothub-explorer" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></li><li><p>Navigate to your IoT Hub in the azure portal, and return to your shared access policy, <code>workshop-policy</code>. Copy the Connection string. You'll need this to authenticate with the iothub-explorer.</p></li></ol><p><img src="/assets/img/copy-conn-string.3a629849.png" alt></p><ol start="3"><li>Open a terminal window and type in the following command, replacing the <code>&lt;device-id&gt;</code> with the ID of your Electron and pasting the Shared access policy connection string in place of <code>&lt;connection-string&gt;</code> after login. Make sure to leave the quotation marks in place.</li></ol><div class="language-bash extra-class"><pre class="language-bash"><code>iothub-explorer monitor-events <span class="token operator">&lt;</span>device-id<span class="token operator">&gt;</span> --login <span class="token string">&quot;&lt;connection-string&gt;&quot;</span>
</code></pre></div><p>If you've authenticated correctly, you'll see the message &quot;Monitoring events from device <code>&lt;device-id&gt;</code>...&quot;. After a moment, you should see events streaming into the Azure IoT Hub!</p><p><img src="/assets/img/iothubexplorer.8c10108b.gif" alt></p><p>Once you're streaming device data into the Azure IoT Hub, you can pipe the data into Azure table storage, set-up streaming analytics to transform the data, create Azure Web Apps, reports with Power BI, use Azure Machine Learning, and more! In the next section, we'll set-up a streaming analytics job and visualize our data in Power BI.</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/particle-iot/filemaker-workshop-2019/edit/master/docs/ch3.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/ch2.html" class="prev">
          Chapter 2: Working with Particle primitives &amp; Grove Sensors
        </a></span><!----></p></div></div></div></div>
    <script src="/assets/js/0.61bfee1a.js" defer></script><script src="/assets/js/app.bfbb8189.js" defer></script>
  </body>
</html>
